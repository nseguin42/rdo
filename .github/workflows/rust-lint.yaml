name: Rust Lint
on:
  workflow_call:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: install tools
        run: |
          rustup component add clippy
          rustup component add rustfmt
          cargo install cargo-audit clippy-sarif sarif-fmt
      - name: cargo check --verbose
        run: cargo check --verbose
      - name: cargo fmt --verbose -- --check
        run: cargo fmt --verbose -- --check
      - name: cargo clippy
          --all-features
          --message-format=json | clippy-sarif | tee rust-clippy-results.sarif | sarif-fmt
        run: cargo clippy
          --all-features
          --message-format=json | clippy-sarif | tee rust-clippy-results.sarif | sarif-fmt
      - name: cargo audit
        run: cargo audit
      - name: cargo doc --verbose
        run: cargo doc --verbose
      - name: Upload clippy analysis results to GitHub
        uses: github/codeql-action/upload-sarif@v2.2.5
        with:
          sarif_file: rust-clippy-results.sarif
          wait-for-processing: true
